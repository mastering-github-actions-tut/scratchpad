name: compile PR changelog 

on:
    pull_request: 

jobs:
    create-changlog:
        runs-on: ubuntu-latest
        steps:
            - name: checkout repo
              uses: actions/checkout@v4

        
            - name: Get PR commits
              id: commits 
              env:
                GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
              run: |
                echo "Fetching commits for PR #${PR_NUMBER}"
                
                CHANGELOG=$(curl -s -H "Authorization: token $GITHUB_TOKEN" \
                "https://api.github.com/repos/${{ github.repository }}/pulls/${{ github.event.number }}/commits" | \
                jq -r '.[] | "Commit SHA: \(.sha)\t\tMessage: \(.commit.message)\n---"') 
                
                echo "CHANGELOG=$CHANGELOG" >> "$GITHUB_OUTPUTS"
                
            - name: Print commits of PR
              run: |
                echo "${{ steps.commits.outputs.CHANGELOG }}" >> $GITHUB_STEP_SUMMARY

                            
                

